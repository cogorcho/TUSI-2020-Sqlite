{% extends "base2.html" %}
{% block content %}
<div class="outer">
<div class="inner">
    <h1>Buscar Escuelas</h1>
<form class="form-inline"></form>
<div class="form-group">
    <label for="prov" class="col-sm-2">Provincia</label>

    <select name="prov" id="prov" class="form-control">
        <option id="0">Seleccionar</option>
        {% for p in data['recs']['provs'] %}
            <option id="{{p.id}}">{{p.nombre}}</option>
        {% endfor %}
    </select>
</div>

<div class="form-group">
    <label for="loc" class="col-sm-2">Localidad</label>
    <select name="loc" id="loc" class="form-control">

    </select>
</div>

<div class="form-group">
    <label for="sec" class="col-sm-2">Sector</label>
    <select name="sec" id="sec" class="form-control">
        <option id="0">Todos</option>
        {% for p in data['recs']['secs'] %}
            <option id="{{p.id}}">{{p.nombre}}</option>
        {% endfor %}
    </select>
</div>

<div class="form-group">
    <label for="amb" class="col-sm-2">√Åmbito</label>
    <select name="amb" id="amb" class="form-control">
        <option id="0">Todos</option>
        {% for p in data['recs']['ambs'] %}
            <option id="{{p.id}}">{{p.nombre}}</option>
        {% endfor %}
    </select>
</div>


<button type="submit" id="buscar" class="btn btn-primary">Buscar</button>
</form>

</div>

</div>

<script>
    var provid = 0;
    var locid = 0;
    var ambid = 0;
    var secid = 0;
    var provsel = "";
    var locsel = "";
    var secsel = "";
    var ambsel = "";
    var url = "";
    
    function prn(data) {
        console.log(data);
    }

    function getdata() {
        console.log('getdata')
        provsel = $(this).children("option:selected").val();
        provid = $(this).children("option:selected").attr("id");

        url = "/localidad/" + provid;
        console.log(url);

        $.getJSON(url).done(function(data){
            dl = data.recs.length;
            $("#loc").empty();
            for (var i = 0; i < dl; i++) {
                $('#loc').append($('<option>').val(data.recs[i].id).text(data.recs[i].nombre)); 
            }
        });
    }

    $("#prov").change(getdata);

    $("#loc").change(function(){
        locsel = $(this).children("option:selected").val();
        locid = $(this).children("option:selected").attr("value");
        console.log(locsel, locid)
    })

    $("#sec").change(function(){
        secsel = $(this).children("option:selected").val();
        secid = $(this).children("option:selected").attr("id");
    });

    $("#amb").change(function(){
        ambsel = $(this).children("option:selected").val();
        ambid = $(this).children("option:selected").attr("id");
    });

    $( "#buscar" ).click(function() {
        if (provid == 0) {
            alert("La provincia es obligatoria")
            return
        }
        var url = '/escuelas/' + provid + "/" + locid + "/" + secid + "/" + ambid
        console.log( url );
        location.href=url;
    });

</script>
{% endblock%}
